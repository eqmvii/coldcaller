<!DOCTYPE html>

<html lang="en-us">

<head>

  <meta charset="UTF-8">
  <title>Sign-Up Today!</title>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7"
    crossorigin="anonymous">

  <!-- LINK TO FIREBASE GOES HERE -->
  <script src="https://www.gstatic.com/firebasejs/4.11.0/firebase.js"></script>
</head>

<body>

  <div class="container">

    <br>

    <!-- Jumbotron -->
    <div class="jumbotron">
      <h1 class="text-center">Test</h1>
    </div>

    <div class="row">

      <!-- Sign-Up Panel-->
      <div class="col-lg-6">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">New Member Sign-Up</h3>
          </div>
          <div class="panel-body">

            <!-- Sign-up Form (note the various input "types")-->


            <button class="btn btn-default" id="add-user" type="submit">Submit</button>

            <button class="btn btn-default" id="reset" type="submit">Reset Students</button>

          </div>

        </div>

      </div>

      <!-- Most Recent Member Panel -->
      <div class="col-lg-6">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Most Recent Member</h3>
          </div>
          <div class="panel-body" id="recent-member">
            <h1 id="chosen-student">empty</h1>
            <h2>Students left:
              <span id="students-left">empty</span>
            </h2>
            <!-- <h2 id="name-display"></h2>
            <h4 id="email-display"></h4>
            <h4 id="age-display"></h4>
            <p id="comment-display"></p> -->
          </div>
        </div>
      </div>

    </div>

  </div>

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery.js"></script>

  <!-- Script -->
  <script>
    // START CODING BELOW!!
    // var students = ["Kaitlyn	Roecker", "Paula	MacTavish", "Joe	McCreesh", "Anna	Jolly", "Dennis	Bereznyak", "Adeline	Johnson", "Dennis	Ruto", "Marc	Lewin", "Dirk	Wiggins", "Matthew	Jefferis", "Matthew	McCarthy", "Randall	Reitz", "Anthony	Elliott", "Charles	Goodwin", "SARA	BROAD", "Isaac	Lubanko", "Khalil	Owens", "Clay	Fairbanks", "Matthew	Wright", "Kushagra	Bhavsar", "Julian	Skodzinski", "Alexa	Stefanou", "Drita	Dhami", "George	Xia", "Jonathan	Dowd", "Katherine	Wang", "Bernard	Augustin", "Karina	Khachatryan", "Noah	Grubb"];
    var students = ["BROKEN", "IT IS BROKEN"];
    // Initialize Firebase
    // Eric's credentials for cold caller
    var config = {
      apiKey: "AIzaSyBmiMtgOTC4sW7WZRj8NQYtwFjv-MnzrtU",
      authDomain: "coldcaller-mw.firebaseapp.com",
      databaseURL: "https://coldcaller-mw.firebaseio.com",
      projectId: "coldcaller-mw",
      storageBucket: "",
      messagingSenderId: "441279042207"
    };

    firebase.initializeApp(config);

    // Create a variable to reference the database.
    var database = firebase.database();

    // Initial Values
    var name = "default";
    var email = "default";
    var age = -1;
    var comment = "default";
    var studentArray = ["Eric", "Bob", "Rachel"];

    // Capture Reset Button Click
    $("#reset").on("click", function (event) {
      event.preventDefault();
      console.log("Reset clicked!");
      students = ["Kaitlyn	Roecker", "Paula	MacTavish", "Joe	McCreesh", "Anna	Jolly", "Dennis	Bereznyak", "Adeline	Johnson", "Dennis	Ruto", "Marc	Lewin", "Dirk	Wiggins", "Matthew	Jefferis", "Matthew	McCarthy", "Randall	Reitz", "Anthony	Elliott", "Charles	Goodwin", "SARA	BROAD", "Isaac	Lubanko", "Khalil	Owens", "Clay	Fairbanks", "Matthew	Wright", "Kushagra	Bhavsar", "Julian	Skodzinski", "Alexa	Stefanou", "Drita	Dhami", "George	Xia", "Jonathan	Dowd", "Katherine	Wang", "Bernard	Augustin", "Karina	Khachatryan", "Noah	Grubb"];
      age++;
      // Code for "Setting values in the database"
      database.ref().set({
        name: name,
        email: email,
        age: age,
        comment: comment,
        studentArray: students
      });
    });

    // Capture Random Button Click
    $("#add-user").on("click", function (event) {
      event.preventDefault();
      console.log("Random clicked!");
      console.log("Students right now: ");
      console.log(students);
      age++; // hacky right now

      // Grabbed values from text-boxes
      //name = $("#name-input").val().trim();
      // email = $("#email-input").val().trim();
      // age = $("#age-input").val().trim();
      // comment = $("#comment-input").val().trim();

      // Code for "Setting values in the database"
      database.ref().set({
        name: name,
        email: email,
        age: age,
        comment: comment,
        studentArray: students
      });

    });

    // Firebase watcher + initial loader HINT: .on("value")
    database.ref().on("value", function (snapshot) {


      // Log everything that's coming out of snapshot
      console.log(snapshot.val());
      console.log(snapshot.val().name);
      console.log(snapshot.val().email);
      console.log(snapshot.val().age);
      console.log(snapshot.val().comment);
      console.log(snapshot.val().students);

      // set students locally
      students = snapshot.val().studentArray.slice();

      var rnd = Math.floor(Math.random() * snapshot.val().studentArray.length);      // returns a number between 0 and last index in array
      console.log(rnd);


      // Change the HTML to reflect
      $("#name-display").text(snapshot.val().name);
      $("#email-display").text(snapshot.val().email);
      $("#age-display").text(snapshot.val().age);
      $("#comment-display").text(snapshot.val().comment);
      $("#chosen-student").text(snapshot.val().studentArray[rnd]);
      $("#students-left").text(snapshot.val().studentArray.length);

      // Handle the errors
    }, function (errorObject) {
      console.log("Errors handled: " + errorObject.code);
    });
  </script>

</body>

</html>
